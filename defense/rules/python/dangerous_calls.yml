rules:
- id: py-os-system-user-input
  languages: [python]
  message: "Potential command injection: os.system with user-controlled input"
  severity: ERROR
  patterns:
  - pattern: os.system($CMD)
  - metavariable-pattern:
      metavariable: $CMD
      patterns:
      - pattern-either:
        - pattern: input(...)
        - pattern: $X + $Y
        - pattern: f"...{$X}..."

- id: py-subprocess-shell
  languages: [python]
  message: "subprocess.* with shell=True is dangerous"
  severity: ERROR
  patterns:
  - pattern: subprocess.$FUNC(..., shell=True, ...)
  - metavariable-regex:
      metavariable: $FUNC
      regex: "run|Popen|call|check_output"

- id: py-eval-exec
  languages: [python]
  message: "Use of eval/exec is dangerous with user input"
  severity: ERROR
  pattern-either:
  - pattern: eval(...)
  - pattern: exec(...)

- id: py-yaml-unsafe-load
  languages: [python]
  message: "yaml.load is unsafe, use safe_load"
  severity: WARNING
  pattern: yaml.load(...)

- id: py-pickle-loads
  languages: [python]
  message: "pickle.loads is unsafe on untrusted input"
  severity: WARNING
  pattern: pickle.loads(...)